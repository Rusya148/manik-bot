# Manik Bot

Телеграм-бот для записи клиентов, контроля календаря, формирования расписания,
а также учета зарплаты и трат. Работает на `aiogram` (v2), хранит данные в SQLite.

## Возможности

- Запись клиента: имя, ссылка/id, время, дата, предоплата.
- Календарь записей с отметками занятых дней.
- Просмотр клиентов на сегодня / неделю / весь период.
- Удаление клиента по ссылке/id.
- Учет зарплаты по месяцам (добавление и просмотр, удаление последней суммы).
- Учет трат по месяцам (добавление и просмотр, удаление последней суммы).
- Генерация расписания по выбранным дням с учетом уже записанных клиентов.

## Быстрый старт

1) Установите зависимости:

```
pip install -r requirements
```

2) Укажите токен бота:

В файле `bot/config.py` заполните:

```
token = 'YOUR_TELEGRAM_BOT_TOKEN'
```

3) Запустите бота:

```
python main_launch.py
```

## Доступ и авторизация

Команда `/start` доступна только для заданных пользователей.
Список ID находится в `handlers/start.py` (переменная `AUTHORIZED_USERS`).

Если нужно добавить новых администраторов — внесите их ID в список.

## Команды и сценарии

Все команды доступны через меню клавиатуры:

- **Записать клиента** — пошаговый диалог: имя → ссылка/id → время → дата → предоплата.
- **Клиенты** — просмотр записей: сегодня / неделя / все.
- **Удалить клиента** — удаление записи по ссылке/id.
- **Календарь** — просмотр календаря с отмеченными днями записей.
- **Расписание** — выбор дней и генерация расписания.
- **Зарплата** — добавление суммы, просмотр за месяц.
- **Траты** — добавление суммы, просмотр за месяц.

### Форматы ввода

- Дата: `DD.MM.YYYY` (например, `25.01.2026`).
- Время: допускаются варианты `11:00`, `11.00`, `11-00`, `11`.

## Генерация расписания

Модуль расписания (`handlers/schedule.py`) использует набор "слотов" по умолчанию:

- Пн–Пт: 11:00, 14:00, 17:00, 19:00
- Сб–Вс: 10:00, 13:00, 16:00, 18:00

При генерации расписания уже занятые времена помечаются,
а слоты, попадающие ближе чем на 90 минут к записи, исключаются.

## Структура проекта

```
bot/            # инициализация бота и dispatcher
handlers/       # обработчики команд и callback
keyboards/      # клавиатуры (reply/inline)
database/       # работа с SQLite
states/         # FSM состояния
main_launch.py  # точка входа
```

## Базы данных

По умолчанию используются SQLite файлы в корне проекта:

- `database_client.db` — клиенты, зарплата, траты.
- `shedule.db` — выбранные дни для расписания.

Таблицы создаются автоматически при первом запуске.

## Полезные заметки

- Для корректной работы календаря обязательно указывать дату.
- При удалении клиента используется поле `link` (ссылка/id).
- Для "Расписания" сначала выберите дни, затем нажмите "Сгенерировать расписание".
- База `database_client.db` содержит историю и может быть копируемой
  для резервного бэкапа.

## Разработка

- Python 3.9+ (рекомендуется).
- `aiogram==2.25.1` (см. `requirements`).

